<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Chat with {{participant}}</title>

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- Custom CSS -->
  <style>
    body {
      background-color: #f5f5f5;
    }

    .chat-container {
      max-width: 900px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      height: 90vh;
      background-color: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .chat-header {
      padding: 15px;
      background-color: #007bff;
      color: #fff;
      display: flex;
      align-items: center;
    }

    .chat-header img {
      border-radius: 50%;
      margin-right: 15px;
    }

    .chat-header h5 {
      margin: 0;
    }

    .chat-history {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      background-color: #f5f5f5;
    }

    .message {
      display: flex;
      margin-bottom: 15px;
    }

    .message.sent {
      justify-content: flex-end;
    }

    .message.received {
      justify-content: flex-start;
    }

    .message-content {
      max-width: 60%;
      padding: 10px 15px;
      border-radius: 20px;
      position: relative;
      word-wrap: break-word;
    }

    .message.sent .message-content {
      background-color: #007bff;
      color: #fff;
      border-bottom-right-radius: 0;
    }

    .message.received .message-content {
      background-color: #e9ecef;
      color: #000;
      border-bottom-left-radius: 0;
    }

    .message .timestamp {
      font-size: 0.75rem;
      color: gray;
      margin-top: 5px;
    }

    .chat-footer {
      padding: 10px 15px;
      background-color: #fff;
      border-top: 1px solid #ddd;
    }

    .chat-footer .input-group {
      display: flex;
    }

    .chat-footer .form-control {
      border-radius: 20px;
      resize: none;
    }

    .chat-footer .btn {
      border-radius: 50%;
      margin-left: 10px;
    }

    .typing-indicator {
      display: none;
      color: gray;
      font-style: italic;
      margin-left: 15px;
      margin-bottom: 5px;
    }

    .back-button {
      text-decoration: none;
      color: #fff;
      font-size: 1.2rem;
      margin-right: 15px;
    }
  </style>
</head>

<body>
  <div class="chat-container">
    <!-- Chat Header -->
    <div class="chat-header">
      <a href="chats.html" class="back-button"><i class="fas fa-arrow-left"></i></a>
      <img id="participant-image" src="assets/img/users/default.jpg" alt="Participant" width="50" height="50">
      <h5 id="chat-participant">Chat with Participant</h5>
    </div>

    <!-- Chat History -->
    <div id="chat-history" class="chat-history">
      <!-- Messages will be dynamically loaded here -->
    </div>

    <!-- Typing Indicator -->
    <p id="typing-indicator" class="typing-indicator">Participant is typing...</p>

    <!-- Chat Footer -->
    <div class="chat-footer">
      <div class="input-group">
        <textarea id="message-input" class="form-control" rows="1" placeholder="Type a message..."></textarea>
        <button class="btn btn-secondary" id="attachment-button"><i class="fas fa-paperclip"></i></button>
        <button class="btn btn-primary" id="send-message"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>
  </div>

  <!-- Attachment Input (Hidden) -->
  <input type="file" id="attachment-input" style="display: none;">

  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Custom JS -->
  <script>
    // Sample chat data (replace with API call if needed)
    const chatData = {
      1: { participant: "John Doe", participantImage: "john_doe.jpg", messages: ["Hello!", "See you tomorrow!"] },
      2: { participant: "Mary Smith", participantImage: "mary_smith.jpg", messages: ["Can we reschedule?", "Sure, what time?"] },
      3: { participant: "Class Group", participantImage: "class_group.jpg", messages: ["Project submission?"] },
      4: { participant: "Alice Tutor", participantImage: "alice_tutor.jpg", messages: ["Don't forget the quiz!"] }
    };

    // List of auto-replies (simple AI simulation)
    const autoReplies = [
      "Got it!",
      "I'll get back to you shortly.",
      "Sounds good!",
      "Sure thing!",
      "Let me know if you need anything else.",
      "Thanks for reaching out!"
    ];

    const params = new URLSearchParams(window.location.search);
    const chatId = params.get('chatId');
    const participant = params.get('name');

    const chatHistory = document.getElementById('chat-history');
    const typingIndicator = document.getElementById('typing-indicator');
    const messageInput = document.getElementById('message-input');
    const participantImage = document.getElementById('participant-image');

    // Populate participant name and image
    document.getElementById('chat-participant').textContent = participant;
    participantImage.src = `assets/img/users/${chatData[chatId].participantImage}`;

    // Load existing messages
    chatData[chatId].messages.forEach(message => {
      appendMessage(message, "received");
    });

    // Function to send a message
    function sendMessage() {
      const messageText = messageInput.value.trim();

      if (messageText) {
        appendMessage(messageText, "sent");
        messageInput.value = '';
        chatHistory.scrollTop = chatHistory.scrollHeight; // Auto-scroll to bottom

        // Simulate typing indicator and auto-reply
        typingIndicator.style.display = 'block';

        setTimeout(() => {
          typingIndicator.style.display = 'none';
          const reply = generateReply(messageText);
          appendMessage(reply, "received");
          chatHistory.scrollTop = chatHistory.scrollHeight; // Auto-scroll again
        }, 1000);
      }
    }

    // Send message with the Enter key
    messageInput.addEventListener('keypress', (event) => {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault(); // Prevent new line
        sendMessage();
      }
    });

    // Send message with the Send button
    document.getElementById('send-message').addEventListener('click', sendMessage);

    // Attachment button click
    document.getElementById('attachment-button').addEventListener('click', () => {
      document.getElementById('attachment-input').click();
    });

    // Handle attachment upload
    document.getElementById('attachment-input').addEventListener('change', function () {
      if (this.files && this.files[0]) {
        const fileName = this.files[0].name;
        appendAttachment(fileName, "sent");
        chatHistory.scrollTop = chatHistory.scrollHeight; // Auto-scroll to bottom

        // Simulate typing indicator and auto-reply
        typingIndicator.style.display = 'block';

        setTimeout(() => {
          typingIndicator.style.display = 'none';
          const reply = "Thanks for the attachment!";
          appendMessage(reply, "received");
          chatHistory.scrollTop = chatHistory.scrollHeight; // Auto-scroll again
        }, 1000);
      }
    });

    // Function to append messages to the chat history
    function appendMessage(text, type) {
      const messageElement = document.createElement('div');
      messageElement.classList.add('message', type);

      const messageContent = document.createElement('div');
      messageContent.classList.add('message-content');
      messageContent.innerHTML = text;

      const timestamp = document.createElement('div');
      timestamp.classList.add('timestamp');
      timestamp.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      messageContent.appendChild(timestamp);
      messageElement.appendChild(messageContent);
      chatHistory.appendChild(messageElement);
    }

    // Function to append attachments to the chat history
    function appendAttachment(fileName, type) {
      const messageElement = document.createElement('div');
      messageElement.classList.add('message', type);

      const messageContent = document.createElement('div');
      messageContent.classList.add('message-content');

      messageContent.innerHTML = `
        <i class="fas fa-file"></i> ${fileName}
        <div class="timestamp">${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</div>
      `;

      messageElement.appendChild(messageContent);
      chatHistory.appendChild(messageElement);
    }

    // Simple function to generate replies based on user input
    function generateReply(userMessage) {
      // Basic keyword matching for demo purposes
      const keywords = ["hello", "hi", "thanks", "thank you", "help"];
      const lowerCaseMessage = userMessage.toLowerCase();

      if (keywords.some(keyword => lowerCaseMessage.includes(keyword))) {
        return "You're welcome!";
      }

      // Return a random auto-reply
      return autoReplies[Math.floor(Math.random() * autoReplies.length)];
    }
  </script>
</body>

</html>
